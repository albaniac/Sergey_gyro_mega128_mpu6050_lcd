#include "lcd_manager.h"
#include "common_makros.h"

//==============================================================================================
//==============================================================================================
//==============================================================================================
//==============================================================================================
//==============================================================================================

LCD_MANAGER g_lcd_manager;

void setup() {
  Serial.begin(38400);

  DDRB |= (1 << 5);

  int r = 
  gyro_kalman_setup();
  
  if (r){
    //sprintf(disp4, "Gyro err: %d*", r);
  }


  g_lcd_manager.init();

  delay(1000);

  g_lcd_manager.refresh();

  mux_in_setup();
  mux_out_setup();
  buttons_init();
}

//==============================================================================================
//==============================================================================================
//==============================================================================================
//==============================================================================================
//==============================================================================================

void loop() {
  static double tt = 0;
  INVBIT(PORTB, 5);

  double Xx, Yy;
  gyro_kalman_get_position(Xx, Yy);  


  g_lcd_manager.set_x(Xx);
  g_lcd_manager.set_y(Yy);
//  g_lcd_manager.set_x(tt++);
//  g_lcd_manager.set_y(tt++);

  buttons_update();

  for (char i = 0; i < buttons_get_count(); i++){
    bool need_println = false;
    if (buttons_was_button_pressed(i)){
      need_println = true;
      Serial.print(i);
      Serial.print(" : ");
    }
    if (need_println){
      Serial.println("");
    }
  }

  delay(100);
}

//==============================================================================================
//==============================================================================================
//==============================================================================================
//==============================================================================================
//==============================================================================================

